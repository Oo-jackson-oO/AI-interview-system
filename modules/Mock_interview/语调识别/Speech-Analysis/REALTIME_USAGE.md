# 🎙️ 实时录音分析功能使用指南

## 功能概述

新增的实时录音分析功能允许您：
- 📱 **实时录音**: 通过麦克风进行实时音频录制
- 🛑 **手动停止**: 使用 Ctrl+C 信号优雅停止录音
- 🔍 **即时分析**: 录音结束后立即进行语音特征分析
- 💾 **自动保存**: 录音文件和分析结果自动保存

## 快速开始

### 1. 安装依赖
```bash
# 安装音频录制依赖
pip install pyaudio

# 安装完整依赖包
pip install -r requirements.txt
```

### 2. 运行实时录音分析
```bash
# 方式1: 使用专用启动脚本
python record_and_analyze.py

# 方式2: 直接运行实时分析器
python real_time_analyzer.py
```

## 使用流程

### 🎯 交互式模式
1. **启动程序**: 运行 `python record_and_analyze.py`
2. **查看设备**: 程序会自动列出可用的音频输入设备
3. **开始录音**: 按回车键开始录音
4. **停止录音**: 按 `Ctrl+C` 停止录音并开始分析
5. **查看结果**: 程序自动显示详细的分析结果
6. **保存结果**: 选择是否保存分析结果到JSON文件
7. **继续或退出**: 可以继续录制新的音频或输入 'quit' 退出

### 📋 操作示例
```
🎵 实时语音分析系统
============================================================
功能说明:
- 按回车键开始录音
- 录音过程中按 Ctrl+C 停止录音并分析
- 输入 'quit' 或 'exit' 退出程序
============================================================

📱 可用的音频输入设备:
  设备 0: 麦克风 (采样率: 44100)
  设备 1: 立体声混音 (采样率: 44100)

请按回车键开始录音 (或输入 'quit' 退出): [按回车]

🎙️ 开始录音...
按 Ctrl+C 停止录音并开始分析

[用户说话...]

^C
收到终止信号，正在停止录音...
🛑 录音已停止
💾 录音已保存到: recordings/recording_20250719_011530.wav

🔍 开始分析录音...
音频加载成功: recordings/recording_20250719_011530.wav
音频长度: 5.23秒
语音分析完成

============================================================
🎵 实时录音分析结果
============================================================
📁 音频文件: recording_20250719_011530.wav
⏰ 分析时间: 2025-07-19 01:15:35
⭐ 综合得分: 0.73

🚀 语速分析
   等级: 中等
   得分: 0.6
   音节率: 0.145
   语音活动比例: 0.78
   总时长: 5.23秒

😊 情感语调
   类型: 平静/中性
   得分: 0.65
   平均音调: 185.5Hz
   音调变化: 28.3
   音调范围: 145.2
   能量变化: 0.067

🗣️ 流利度
   等级: 流利
   得分: 0.85
   停顿次数: 3
   停顿比例: 0.12
   语音连续性: 0.88
   节奏稳定性: 0.79

💾 是否保存分析结果? (y/n): y
分析结果已保存到: results/voice_analysis_result_20250719_011535.json

请按回车键开始录音 (或输入 'quit' 退出): quit
👋 感谢使用！
```

## 文件输出

### 📁 目录结构
```
Speech-Analysis/
├── recordings/           # 录音文件存储目录
│   └── recording_YYYYMMDD_HHMMSS.wav
├── results/             # 分析结果存储目录
│   └── voice_analysis_result_YYYYMMDD_HHMMSS.json
└── ...
```

### 🎵 录音文件
- **格式**: WAV (PCM 16-bit)
- **采样率**: 22050 Hz
- **声道**: 单声道
- **命名**: `recording_YYYYMMDD_HHMMSS.wav`

### 📊 分析结果
分析结果以JSON格式保存，包含完整的语音特征数据。

## 技术特性

### 🔧 音频处理
- **实时录制**: 使用PyAudio进行低延迟音频录制
- **线程安全**: 多线程架构确保录音稳定性
- **信号处理**: 优雅处理中断信号 (Ctrl+C)
- **异常处理**: 完善的错误处理和恢复机制

### 📈 分析能力
- **即时分析**: 录音结束后立即开始分析
- **完整特征**: 包含语速、情感、流利度三维分析
- **高精度**: 使用与离线版本相同的分析算法
- **可视化输出**: 友好的控制台结果展示

## 故障排除

### ❗ 常见问题

1. **PyAudio安装失败**
   ```bash
   # Windows
   pip install pipwin
   pipwin install pyaudio
   
   # Linux
   sudo apt-get install portaudio19-dev
   pip install pyaudio
   
   # macOS
   brew install portaudio
   pip install pyaudio
   ```

2. **找不到音频设备**
   - 检查麦克风是否正确连接
   - 确认系统音频权限设置
   - 尝试重新插拔音频设备

3. **录音质量差**
   - 调整麦克风音量
   - 减少环境噪音
   - 靠近麦克风说话

4. **分析结果异常**
   - 确保录音时长大于1秒
   - 检查录音是否包含有效语音
   - 避免录音过程中的长时间静音

### 🔧 高级配置

可以在 `real_time_analyzer.py` 中调整以下参数：

```python
# 音频参数
sample_rate=22050    # 采样率
chunk_size=1024      # 缓冲区大小
channels=1           # 声道数 (1=单声道, 2=立体声)
```

## 应用场景

- 🎤 **演讲练习**: 分析演讲的语速和流利度
- 📞 **语音质量**: 评估录音设备和环境效果
- 🗣️ **口语训练**: 实时反馈发音和表达特征
- 📊 **语音研究**: 快速获取语音特征数据

---

💡 **提示**: 首次使用建议在安静环境下测试，以获得最佳的分析效果！ 